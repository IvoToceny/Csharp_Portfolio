{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "DemoTesting",
      "metadata": {
        "_parameterType": "resourceGroup",
        "description": "Name of the resource group for the resource. It is recommended to put resources under same resource group for better tracking."
      }
    },
    "resourceGroupLocation": {
      "type": "string",
      "defaultValue": "westeurope",
      "metadata": {
        "_parameterType": "location",
        "description": "Location of the resource group. Resource groups could have different location than resources."
      }
    },
    "resourceLocation": {
      "type": "string",
      "defaultValue": "[parameters('resourceGroupLocation')]",
      "metadata": {
        "_parameterType": "location",
        "description": "Location of the resource. By default use resource group's location, unless the resource provider is not supported there."
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "name": "[parameters('resourceGroupName')]",
      "location": "[parameters('resourceGroupLocation')]",
      "apiVersion": "2019-10-01"
    },
    {
      "type": "Microsoft.Resources/deployments",
      "name": "[concat(parameters('resourceGroupName'), 'Deployment', uniqueString(concat('marketcars-api-v1', subscription().subscriptionId)))]",
      "resourceGroup": "[parameters('resourceGroupName')]",
      "apiVersion": "2019-10-01",
      "dependsOn": [
        "[parameters('resourceGroupName')]"
      ],
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "resources": [
            {
              "name": "MarketAppApiManagment",
              "type": "Microsoft.ApiManagement/service",
              "location": "[parameters('resourceLocation')]",
              "properties": {
                "publisherEmail": "ivo6770@gmail.com",
                "publisherName": "IvoTocenyPortfolio",
                "notificationSenderEmail": "apimgmt-noreply@mail.windowsazure.com",
                "hostnameConfigurations": [
                  {
                    "type": "Proxy",
                    "hostName": "marketappapimanagment.azure-api.net",
                    "encodedCertificate": null,
                    "keyVaultId": null,
                    "certificatePassword": null,
                    "negotiateClientCertificate": false,
                    "certificate": null,
                    "defaultSslBinding": true
                  }
                ],
                "publicIPAddresses": [
                  "20.31.101.244"
                ],
                "privateIPAddresses": null,
                "additionalLocations": null,
                "virtualNetworkConfiguration": null,
                "customProperties": {
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168": "false",
                  "Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30": "false"
                },
                "virtualNetworkType": "None",
                "certificates": null,
                "disableGateway": false,
                "apiVersionConstraint": {
                  "minApiVersion": null
                }
              },
              "sku": {
                "name": "Developer",
                "capacity": 1
              },
              "apiVersion": "2019-12-01"
            },
            {
              "type": "Microsoft.ApiManagement/service/apis",
              "name": "MarketAppApiManagment/marketcars-api-v1",
              "properties": {
                "displayName": "MarketCars API v1",
                "apiRevision": "1",
                "description": "This is a Web API for MarketCars App that controls data access to MSSQL using Dapper, Authentication and Authorization by Azure Active Directory, Files control through Azure Blob Storage and Azure SQL Database to store tables, procedures and data there.  API is secured by Rate Limiting, Caching and Data Validation. This is a Demo App for my Portfolio. Feel free to use",
                "subscriptionRequired": true,
                "serviceUrl": "https://marketcarsapi.azurewebsites.net/",
                "path": "",
                "protocols": [
                  "https"
                ],
                "authenticationSettings": {
                  "oAuth2": null,
                  "openid": null
                },
                "subscriptionKeyParameterNames": {
                  "header": "Ocp-Apim-Subscription-Key",
                  "query": "subscription-key"
                },
                "isCurrent": true
              },
              "apiVersion": "2019-12-01",
              "dependsOn": [
                "MarketAppApiManagment"
              ]
            }
          ]
        }
      }
    }
  ],
  "metadata": {
    "_dependencyType": "apis.azure"
  }
}